<!DOCTYPE html>
<html xmlns:f="http://java.sun.com/jsf/core"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:p="http://primefaces.org/ui"
      xmlns:pe="http://primefaces.org/ui/extensions">

    <f:view>
        <h:head>
            <meta http-equiv="Content-Type" content="text/html;charset=UTF-8" />
            <meta name="viewport" content="width=device-width, initial-scale=1.0" />
            <meta name="_csrf" content="${_csrf.token}"/>
            <!-- default header name is X-CSRF-TOKEN -->
            <meta name="_csrf_header" content="${_csrf.headerName}"/>
            <title>#{msgs['APPLICATION.BIG_TITLE']} - #{msgs['APPLICATION.TITLE']}</title>

            <f:facet name="first">
                <h:outputStylesheet library="primefaces" name="primefaces.css" />
                <h:outputStylesheet library="primefaces-extensions" name="primefaces-extensions.css" />
                <h:outputScript library="primefaces" name="jquery/jquery.js" />
                <h:outputScript library="primefaces" name="jquery/jquery-plugins.js" />
            </f:facet>
            <f:facet name="middle">
                <h:outputStylesheet library="css" name="bootstrap.min.css" />
                <h:outputScript library="webjars" name="bootstrap/3.1.1/js/bootstrap.min.js" />
            </f:facet>
            <f:facet name="last">
                <link href='http://fonts.googleapis.com/css?family=PT+Sans' rel='stylesheet' type='text/css'/>
                <h:outputStylesheet library="css" name="font-awesome.css" />
                <h:outputStylesheet library="css" name="opi-candidat.min.css" />
            </f:facet>
        </h:head>
        <body id="body">
            <p:growl id="globalMessages" globalOnly="true" showDetail="true" autoUpdate="true" />

            <ui:include src="exception-panel.xhtml" />
            <div id="content-wrapper">
                <div class="content">
                    <ui:include src="exception-panel.xhtml" />
                    <ui:fragment rendered="#{not empty param['expired']}">
                        <p:dialog modal="true" resizable="false" dynamic="true" visible="true" closable="false" header="Votre session a expirÃ©" widgetVar="confirmDlg">
                            <f:facet name="footer">
                                <div class="ui-dialog-footer clearfix">
                                    <div class="pull-right">
                                        <a href="#{request.contextPath}/" class="btn btn-default btn-sm">Fermer</a>
                                    </div>
                                </div>

                            </f:facet>
                        </p:dialog>
                    </ui:fragment>
                    <p:ajaxStatus onstart="sendCsrf();"  />
                    <ui:insert name="main"/>
                </div>
            </div>


            <h:outputScript library="js" name="primefaces-locales.js" />
            <h:outputScript>
                function sendCsrf() {
                    var token = $("meta[name='_csrf']").attr("content");
                    var header = $("meta[name='_csrf_header']").attr("content");

                    $(document).on('pfAjaxSend.' + this.id, function(e, xhr, options) {
                        console.log(options);
                        console.log(e);
                        console.log(xhr);
                        xhr.setRequestHeader(header, token);
                    });
                };

                function activateCurrentMenuItem() {
                    currentPath = window.location.pathname;
                    $("nav > ul > li > a").each(function() {
                        element = $(this);
                        if (element.attr('href') == currentPath) {
                            parent = $(element.parent());
                            parent.addClass("active");
                            return;
                        }
                    });
                }

                $(document).ready(function() {
                    $("input[type=text]").addClass("form-control");
                    $("[data-toggle=tooltip]").tooltip();
                    activateCurrentMenuItem();

                    // select the target node
                    var target = document;

                    // create an observer instance
                    var observer = new MutationObserver(function(mutations) {
                        mutations.forEach(function(mutation) {
                            $("input[type=text]").addClass("form-control");
                            $("[data-toggle=tooltip]").tooltip();
                            activateCurrentMenuItem();
                        });
                    });

                    // configuration of the observer:
                    var config = { attributes: false, childList: true, characterData: true, subtree: true };

                    // pass in the target node, as well as the observer options
                    observer.observe(target, config);
                });
            </h:outputScript>
        </body>
    </f:view>
</html>
