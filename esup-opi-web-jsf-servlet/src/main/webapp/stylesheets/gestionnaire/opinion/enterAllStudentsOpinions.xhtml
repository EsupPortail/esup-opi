<ui:composition xmlns:f="http://java.sun.com/jsf/core"
    xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns:h="http://java.sun.com/jsf/html"
    xmlns:p="http://primefaces.org/ui"
    template="template.xhtml">
    <ui:define name="content">
    	<div id="maPage" class="div_body">
    		<h1><h:outputText value="#{managedAccess.currentTraitement.libelle}" /></h1>
    		<ui:include src="/stylesheets/gestionnaire/opinion/_block/_lookForIndividu.jsp" />
    		<ui:include src="/stylesheets/gestionnaire/opinion/_block/_proposition.jsp" />
    		<h:form id="seeOpinionsForm">
    			<br />
    			<div class="messageForUser">
    				<p:message id="messages" showDetail="true" autoUpdate="true" />
    			</div>
    			<br />
    			<div style="text-align:center;">
    				<h:outputText value="#{msgs['AVIS.ENTER.DECISION']}" />
    				<p:selectOneMenu id="choiceTypDecision"
    					converter="#{typeDecisionConverter}"
    					onchange="javascript:{simulateLinkClick('seeOpinionsForm:changeTypeDecision');}"
    					valueChangeListener="#{opinionController.selectTypeDecision}"
    					value="#{opinionController.selectedTypeDec}">
    					<f:selectItems value="#{nomenclatureController.typeDecisionItems}" />
    				</p:selectOneMenu>
    				<p:commandButton id="changeTypeDecision"
    					value="#{msgs[_.BUTTON.CHANGE]}"
    					action="#{opinionController.selectTypeDecision}" />
    			</div>
    			<div style="width:100%;text-align:right;">
    				<h:panelGroup>
    					<p:commandButton value="#{msgs['_.BUTTON.SAVE']}"
    						action="#{opinionController.saveAll}" />
    					<p:commandButton value="#{msgs['_.BUTTON.BACK']}" immediate="true"
    						action="#{managedAccess.goDisplayFunction}" />
    				</h:panelGroup>
    			</div>
    
    
    			<div style="width:100%;">
    				<p:dataTable var="individuPojo" id="individuData"
    					value="#{paginatorIndividuPojo.indPojosWithWishForOneCmi}"
    					styleClass="paginatorData"
    					rendered="#{not empty paginatorIndividuPojo.indPojosWithWishForOneCmi}" rowIndexVar="variable">
    					<f:facet name="header">
    						<h:panelGroup>
    							<e:paginator id="paginatorIndividuPojo"
    								paginator="#{paginatorIndividuPojo}"
    								itemsName="#{msgs['INDIVIDUS']}"
    								onchange="javascript:{simulateLinkClick('seeOpinionsForm:individuData:submitPageSize');}" />
    							<p:commandButton id="submitPageSize"
    								action="#{paginatorIndividuPojo.forceReload}" />
    						</h:panelGroup>
    					</f:facet>
    					<p:column width="10%">
    						<f:facet name="header">
    							<h:outputText value="#{msgs['INDIVIDU.NUM_DOSSIER']}" />
    						</f:facet>
    						<h:outputText value="#{individuPojo.individu.numDossierOpi}" />
    					</p:column>
    					<p:column width="20%">
    						<f:facet name="header">
    							<h:outputText value="#{msgs['INDIVIDU.NOM_PRENOM']}" />
    						</f:facet>
    						<h:outputText
    							value="#{individuPojo.individu.nomPatronymique} 
    							#{individuPojo.individu.prenom}" />
    					</p:column>
    
    					<p:column width="25%">
    						<p:dataList var="indVoeuxPojo" id="indVoeux"
    							value="#{individuPojo.voeuxSortedByLic}">
    							<ul style="margin: 0px; padding: 0px; height: 20px;">
                                    <h:outputText value="#{indVoeuxPojo.vrsEtape.licEtp}"
                                        style="cursor:pointer;" id="licEtp" />
                                    <p:overlayPanel for="licEtp"
                                        showEvent="mouseover"
                                        hideEvent="mouseout"
                                        styleClass="containerPopup">
										<h:panelGroup>
											<h:panelGrid columns="1">
												<h:outputText styleClass="titrePopupAide"
													value="#{msgs['FIELD_LABEL.LIBELLE']} #{msgs['FIELD_LABEL.VRS_VET']}" />
												<h:outputText styleClass="libellesAide"
													value="#{indVoeuxPojo.vrsEtape.libWebVet}" />
											</h:panelGrid>
										</h:panelGroup>
    								</p:overlayPanel>
    							</ul>
    						</p:dataList>
    					</p:column>
    					<p:column width="2%">
    						<p:dataList var="indVoeuxPojo" id="indVoeux"
    							value="#{individuPojo.voeuxSortedByLic}">
    							<ul style="margin: 0px; padding: 0px; height: 20px;">
    									<h:outputText value="#{indVoeuxPojo.avisEnService.result.code}" />
    									<h:outputText value="(#{indVoeuxPojo.avisEnService.rang})" 
    										rendered="#{indVoeuxPojo.avisEnService.rang != null}"/>
    							</ul>
    						</p:dataList>
    					</p:column>
    					<p:column width="2%">
    						<p:dataList var="indVoeuxPojo" id="indVoeux"
    							value="#{individuPojo.voeuxSortedByLic}">
                                <p:graphicImage url="/media/images/informationSmall.png"
                                    style="cursor:pointer;" id="avisEnService" />
                                <p:overlayPanel for="licEtp"
                                    showEvent="mouseover"
                                    hideEvent="mouseout"
                                    styleClass="containerPopup"
                                    rendered="#{indVoeuxPojo.avisEnService.result.code != null}">
									<h:panelGroup>
										<h:panelGrid columns="1">
											<h:outputText styleClass="titrePopupAide"
												value="#{msgs['AVIS.END']} : #{indVoeuxPojo.avisEnService.result.libelle}" />
											<h:outputText styleClass="libellesAide"
												value="#{indVoeuxPojo.avisEnService.motivationAvis.libelle}" />
											<h:outputText styleClass="libellesAide"
												value="#{indVoeuxPojo.avisEnService.commentaire}" />
										</h:panelGrid>
									</h:panelGroup>
								</p:overlayPanel>
    						</p:dataList>
    					</p:column>
    					<p:column width="2%">
    						<f:facet name="header">
    							<p:selectBooleanCheckbox valueChangeListener="#{opinionController.checkAll}"
    								value="#{opinionController.allChecked}" onclick="submit();">
    							</p:selectBooleanCheckbox>
    						</f:facet>
    						<p:dataList var="indVoeuxPojo" id="indVoeux"
    							value="#{individuPojo.voeuxSortedByLic}">
    							<ul style="margin: 0px; padding: 0px; height: 20px;">
    								<jdt:multipleRowsSelector
    									selectionList="#{opinionController.wishSelected}"
    									disabled="#{indVoeuxPojo.avisEnService.result.isFinal 
    												&& indVoeuxPojo.avisEnService.validation}" />
    							</ul>
    						</p:dataList>
    					</p:column>
    					<p:column rendered="#{paginatorIndividuPojo.isUsingDEF}">
    						<f:facet name="header">
    							<h:outputText value="#{msgs['AVIS.PROPOSITION.SMALL_TITLE']}" />
    						</f:facet>
    						<p:dataList var="indVoeuxPojo" id="indVoeux"
    							value="#{individuPojo.voeuxSortedByLic}">
    							<ul style="margin: 0px; padding: 0px; height: 20px;">
    								<h:panelGroup>
    									<p:commandButton image="/media/images/add.png"
    										immediate="true" styleClass="form-button-image"
    										title="#{msgs['FIELD_LABEL.PROPOSITION']}"
    										rendered="#{managedAccess.updateAuthorized}"
    										action="#{opinionController.addProposition}">
    										<f:setPropertyActionListener value="#{indVoeuxPojo}" target="#{opinionController.indVoeuxPojo}" />
    									</p:commandButton>
    								</h:panelGroup>
    							</ul>
    						</p:dataList>
    					</p:column>
    					<p:column rendered="#{paginatorIndividuPojo.isUsingLC}">
    						<f:facet name="header">
    							<h:outputText value="#{msgs['AVIS.RANG']}" />
    						</f:facet>
    						<p:dataList var="indVoeuxPojo" id="indVoeux"
    							value="#{individuPojo.voeuxSortedByLic}">
    							<ul style="margin: 0px; padding: 0px; height: 20px;">
    								<h:panelGroup>
    									<h:inputText id="rang" size="5"
    										value="#{indVoeuxPojo.newAvis.rang}" maxlength="5"
    										disabled="#{indVoeuxPojo.avisEnService.result.isFinal 
    											&& indVoeuxPojo.avisEnService.validation}" />
    								</h:panelGroup>
    							</ul>
    						</p:dataList>
    					</p:column>
    					<p:column width="10%" rendered="#{paginatorIndividuPojo.isUsingDEF}">
    						<f:facet name="header">
    							<h:panelGroup>
    								<h:outputText value="#{msgs['AVIS.MOTIVATION']}" />
    								
    								<p:selectOneMenu id="choiceAllMotivAvis"
    									converter="#{motivationAvisConverter}"
    									onchange="javascript:{changeAllMotivAvis('seeOpinionsForm:individuData','classChoiceMotivAvis',this);}">
    									<f:selectItem itemLabel="" itemValue="" />
    									<f:selectItems var="motivationAllAvis" value="#{nomenclatureController.motivationsAvis}"
    										itemLabel="#{motivationAllAvis.nomenclature.code}-#{motivationAllAvis.nomenclature.shortLabel}"
    										itemValue="#{motivationAllAvis.nomenclature}" />
    								</p:selectOneMenu>
    							</h:panelGroup>
    						</f:facet>
    						<p:dataList var="indVoeuxPojo" id="indVoeux"
    							value="#{individuPojo.voeuxSortedByLic}">
    							<ul style="margin: 0px; padding: 0px; height: 20px;">
    								<h:panelGroup>
    									<p:selectOneMenu id="choiceMotivAvis"
    										styleClass="classChoiceMotivAvis"
    										converter="#{motivationAvisConverter}"
    										value="#{indVoeuxPojo.newAvis.motivationAvis}"
    										disabled="#{indVoeuxPojo.avisEnService.result.isFinal 
    											&& indVoeuxPojo.avisEnService.validation}">
    										<f:selectItem itemLabel="" itemValue="" />
    										<f:selectItems var="motivationAvis"
    											value="#{nomenclatureController.motivationsAvis}"
    											itemLabel="#{motivationAvis.nomenclature.code}-#{motivationAvis.nomenclature.shortLabel}"
    											itemValue="#{motivationAvis.nomenclature}" />
    									</p:selectOneMenu>
    								</h:panelGroup>
    							</ul>
    						</p:dataList>
    					</p:column>
    					<p:column width="20%">
    						<f:facet name="header">
    							<h:outputText value="#{msgs['FIELD_LABEL.COMMENTAIRE']}" />
    						</f:facet>
    						<p:dataList var="indVoeuxPojo" id="indVoeux"
    							value="#{individuPojo.voeuxSortedByLic}">
    							<ul style="margin: 0px; padding: 0px; height: 20px;">
    								<h:inputText id="commentaire" size="30"
    									value="#{indVoeuxPojo.newAvis.commentaire}" maxlength="500"
    									disabled="#{indVoeuxPojo.avisEnService.result.isFinal 
    											&& indVoeuxPojo.avisEnService.validation}" />
    							</ul>
    						</p:dataList>
    					</p:column>
    					<p:column width="2%">
    						<p:dataList var="indVoeuxPojo" id="indVoeux"
    							value="#{individuPojo.voeuxSortedByLic}">
    							<ul style="margin: 0px; padding: 0px; height: 20px;">
    								<p:commandButton image="/media/images/magnifier.png"
    									immediate="true" styleClass="form-button-image"
    									title="#{msgs['BUTTON.UPDATE']}"
    									rendered="#{managedAccess.updateAuthorized}"
    									action="#{opinionController.goSeeOpinionVoeu}">
    									<f:setPropertyActionListener value="#{indVoeuxPojo}" target="#{opinionController.indVoeuxPojo}" />
    									<f:setPropertyActionListener value="#{opinionController.wayfEnum.opinionAllValue}" target="#{opinionController.wayfEnum.whereAreYouFrom}" />
    								</p:commandButton>
    							</ul>
    						</p:dataList>
    					</p:column>
    
    
    				</p:dataTable>
    			</div>
    
    		</h:form>
    
    		<h:outputText value="#{msgs['INDIVIDU.NOT.FOUND']}"
    			rendered="#{empty paginatorIndividuPojo.visibleItems}" />
    
    		<br />
    		<br />
    		<br />
    
    	</div>
    	
    	<script type="text/javascript">
        	highlightChildrenLiTags('navigationHeader:navigation');
        	highlightChildrenLiTags('navigationFooter:navigation');
        	hideElement('seeOpinionsForm:individuData:submitPageSize');
        	hideElement('seeOpinionsForm:changeTypeDecision');
        	hideElement('seeOpinionsForm:individuData:submitChangeMotiv');
        </script>
    </ui:define>
</ui:composition>