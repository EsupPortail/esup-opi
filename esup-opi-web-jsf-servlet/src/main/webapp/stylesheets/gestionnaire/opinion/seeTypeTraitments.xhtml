<ui:composition xmlns:f="http://java.sun.com/jsf/core"
    xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns:h="http://java.sun.com/jsf/html"
    xmlns:p="http://primefaces.org/ui"
    template="template.xhtml">
    <ui:define name="content">
    	
    	
    	<div id="maPage" class="div_body">
    		<h1><h:outputText value="#{managedAccess.currentTraitement.libelle}" /></h1>
            <ui:fragment rendered="#{not empty managedAccess.domainAccueilGest}">
        		<div id="blockFormSearch" class="blockForm">
        			<h:form id="lookForIndForm" styleClass="opiR1_form">
        				<h:panelGrid columns="2" columnClasses="col1UnDemi,col2UnDemi"
        					styleClass="tableJustWidthMax">
        					<h:outputText value="#{msgs['FIELD_LABEL.LOOK_FOR.IND']}"
        						styleClass="section-smallTitle" />
        					<h:panelGroup>
        						<p:commandButton value="#{msgs['_.BUTTON.SEARCH']}"
        							action="#{typeTraitController.filterPaginator}" />
        					</h:panelGroup>
        				</h:panelGrid>
        
        				<h:panelGrid styleClass="tableWidthMax" columns="4"
        					columnClasses="colUnQuart,colUnQuart,colUnQuart,colUnQuart">
        					<h:panelGroup>
        						<h:outputLabel value="#{msgs['INDIVIDU.NUM_DOSSIER']}"
        							for="numDossierOpi" />
        					</h:panelGroup>
        					<h:inputText id="numDossierOpi"
        						value="#{paginatorIndividuPojo.indRechPojo.numDossierOpiRecherche}" />
        
        					<h:panelGroup>
        						<h:outputLabel value="#{msgs['TYP_TRT.EXCLURE_TRAITE']}"
        							for="pasIncTraites" />
        					</h:panelGroup>
        					<p:selectBooleanCheckbox id="pasIncTraites"
        						value="#{paginatorIndividuPojo.indRechPojo.excludeWishProcessed}" />
        
        					<h:panelGroup>
        						<h:outputLabel value="#{msgs['INDIVIDU.NOM']}" for="nom" />
        					</h:panelGroup>
        					<h:inputText id="nom"
        						value="#{paginatorIndividuPojo.indRechPojo.nomRecherche}" />
        					<h:panelGroup>
        						<h:outputLabel value="#{msgs['INDIVIDU.PRENOM']}" for="prenom" />
        					</h:panelGroup>
        					<h:inputText id="prenom"
        						value="#{paginatorIndividuPojo.indRechPojo.prenomRecherche}" />
        
        					<h:panelGroup>
        						<h:outputLabel value="#{msgs['FIELD_LABEL.REGIME_INSCRIPTION']}" for="fc" />
        					</h:panelGroup>
        					<p:selectManyCheckbox value="#{paginatorIndividuPojo.listeRI}" converter="javax.faces.Integer"
        						disabled="#{!paginatorIndividuPojo.indRechPojo.canModifyRISearch}"
        						layout="lineDirection">
        						<f:selectItems var="ri" 
        								itemLabel="#{ri.shortLabel}" itemValue="#{ri.code}"
        								value="#{nomenclatureController.allRegimeInscription}"/>
        					</p:selectManyCheckbox>
        					<h:panelGroup>
        						<h:outputLabel value="#{msgs['COMMISSION.CHOICE']}"
        							for="lesCommissions" />
        					</h:panelGroup>
        					<h:panelGroup>
        						<p:selectOneMenu id="lesCommissions"
        							converter="javax.faces.Integer"
        							value="#{paginatorIndividuPojo.indRechPojo.idCmi}">
        							<f:selectItem itemLabel="" itemValue="" />
        							<f:selectItems var="commission"
        								value="#{commissionController.commissionsItemsByRight}"
        								itemLabel="#{commission.libelle}" itemValue="#{commission.id}" />
        						</p:selectOneMenu>
        					</h:panelGroup>
        
        					<h:panelGroup>
        						<h:outputLabel value="#{msgs['FIELD_LABEL.DATE_CREATION']}"
        							for="dateCreationVoeu" />
        					</h:panelGroup>
        					<h:panelGroup>
        						<h:inputText id="dateCreationVoeu" size="10" maxlength="8"
        							value="#{paginatorIndividuPojo.indRechPojo.dateCreationVoeuRecherchee}">
        							<f:convertDateTime pattern="ddMMyyyy"
        								timeZone="#{sessionController.timezone}" />
        							<f:validateLength minimum="8"/>
        						</h:inputText>
        					</h:panelGroup>
        
        				</h:panelGrid>
        			</h:form>
        		</div>
            </ui:fragment>
    		<br />
    		<br />
    
    
    		<h:form id="seeTypeTrtForm">
    
    			<div class="messageForUser">
    				<p:message id="messages" showDetail="true" autoUpdate="true" />
    			</div>
    
    			<div style="width:100%;text-align:right;">
    				<h:panelGroup>
    					<p:commandButton value="#{msgs['_.BUTTON.VALIDATE']}"
    						action="#{typeTraitController.update}"
    						rendered="#{managedAccess.updateAuthorized
    								|| managedAccess.addAuthorized}" />
    					<p:commandButton value="#{msgs['_.BUTTON.CANCEL']}"
    						immediate="true" action="#{typeTraitController.goSeeAllTypeTraitments}" />
    					<p:commandButton value="#{msgs['_.BUTTON.BACK']}" immediate="true"
    						action="#{managedAccess.goDisplayFunction}" />
    					<p:commandButton id="submitSelectTypeTrt"
    										value="#{msgs['_.BUTTON.CHANGE_TYP_TRT']}"
    										action="#{typeTraitController.selectAllTypeAction}" />
    				</h:panelGroup>
    			</div>
    
    
    			<div style="width:100%;">
    				<p:dataTable var="individuPojo" id="individuData"
    					value="#{paginatorIndividuPojo.individuPojos}"
    					styleClass="paginatorData" alternateColors="true"
    					renderedIfEmpty="false" rowIndexVar="variable">
    					<f:facet name="header">
    						<h:panelGroup>
    							<e:paginator id="paginatorIndividuPojo"
    								paginator="#{paginatorIndividuPojo}"
    								itemsName="#{msgs['INDIVIDUS']}"
    								onchange="javascript:{simulateLinkClick('seeTypeTrtForm:individuData:submitPageSize');}" />
    							<p:commandButton id="submitPageSize"
    								action="#{paginatorIndividuPojo.forceReload}" />
    						</h:panelGroup>
    					</f:facet>
    					<p:column width="2%">
    						<p:graphicImage url="/media/images/flag_green.png"
    							title="#{msgs['VOEU.FLAG_TRAITE']}"
    							rendered="#{individuPojo.hasAllVoeuxTraited}" />
    						<p:graphicImage url="/media/images/flag_red.png"
    							title="#{msgs['VOEU.FLAG_NON_TRAITE']}"
    							rendered="#{!individuPojo.hasAllVoeuxTraited}" />
    					</p:column>
    					<p:column width="10%">
    						<f:facet name="header">
    							<h:outputText value="#{msgs['INDIVIDU.NUM_DOSSIER']}" />
    						</f:facet>
    						<h:outputText value="#{individuPojo.individu.numDossierOpi}" />
    					</p:column>
    					<p:column width="10%">
    						<f:facet name="header">
    							<h:outputText value="#{msgs['INDIVIDU.DATE_CREATION']}" />
    						</f:facet>
    						<h:outputText value="#{individuPojo.dateCreationDossier}">
    							<f:convertDateTime pattern="dd/MM/yyyy"
    								timeZone="#{sessionController.timezone}" />
    						</h:outputText>
    					</p:column>
    
    					<p:column width="15%">
    						<f:facet name="header">
    							<h:outputText value="#{msgs['INDIVIDU.NOM_PRENOM']}" />
    						</f:facet>
    						<h:outputText
    							value="#{individuPojo.individu.nomPatronymique} 
    							#{individuPojo.individu.prenom}" />
    					</p:column>
    					<p:column width="21%">
    						<f:facet name="header">
    							<h:outputText value="#{msgs['INDIVIDU.CURSUS.DERNIER']}" />
    						</f:facet>
    						<h:outputText
    							value="#{individuPojo.derniereAnneeEtudeCursus.cursus.annee}
    							#{individuPojo.derniereAnneeEtudeCursus.libCur} 
    							(#{individuPojo.derniereAnneeEtudeCursus.libEtb})"
    							rendered="#{individuPojo.derniereAnneeEtudeCursus != null}" />
    					</p:column>
    
    					<p:column width="2%">
                            <h:panelGroup
                                rendered="#{individuPojo.derniereAnneeEtudeCursus != null}">
                                <p:graphicImage url="/media/images/informationSmall.png"
                                    style="cursor:pointer;" id="infoAnneeUni" />
                                <p:overlayPanel for="codeCom"
                                    showEvent="mouseover"
                                    hideEvent="mouseout"
                                    styleClass="containerPopup">
                                    <h:panelGroup>
                                    	<h:panelGrid columns="1">
                                    		<h:outputText styleClass="titrePopupAide"
                                    			value="#{msgs['INDIVIDU.CURSUS_UNI']}" />
                                    		<p:dataList var="indCursusScolPojo"
                                    			value="#{individuPojo.indCursusScolPojo}"
                                    			layout="unorderedList">
                                    			<p:column>
                                    				<h:outputText value="#{indCursusScolPojo.cursus.annee}"
                                    					styleClass="span-text-small" />
                                    				<h:outputText value=" " styleClass="span-text-small" />
                                    				<h:outputText value="#{indCursusScolPojo.libCur}"
                                    					styleClass="span-text-small" />
                                    				<h:outputText value=" (" styleClass="span-text-small" />
                                    				<h:outputText value="#{indCursusScolPojo.etablissement.libEtb}"
                                    					styleClass="span-text-small" />
                                    				<h:outputText value=")" styleClass="span-text-small" />
                                    			</p:column>
                                    		</p:dataList>
                                    	</h:panelGrid>
                                    </h:panelGroup>
                                </p:overlayPanel>
                            </h:panelGroup>
    					</p:column>
    
    
    					<p:column width="30%" style="text-align:center;">
    						<p:dataList var="indVoeuxPojo" id="indVoeux"
    								value="#{individuPojo.indVoeuxPojo}">
    								<h:panelGroup 
    									rendered="#{!indVoeuxPojo.indVoeu.haveBeTraited 
    										|| !paginatorIndividuPojo.indRechPojo.excludeWishProcessed}" 
    										style="margin:0px;padding:0px;">
                                        <h:outputText value="#{indVoeuxPojo.shortLibVet}"
                                            style="cursor:pointer;" id="shortLibVet" />
                                        <p:overlayPanel for="shortLibVet"
                                            showEvent="mouseover"
                                            hideEvent="mouseout"
                                            styleClass="containerPopup">
											<h:panelGroup>
												<h:panelGrid columns="1">
													<h:outputText styleClass="titrePopupAide"
														value="#{msgs['FIELD_LABEL.LIBELLE']} #{msgs['FIELD_LABEL.VRS_VET']}" />
													<h:outputText styleClass="libellesAide"
														value="#{indVoeuxPojo.vrsEtape.libWebVet}" />
												</h:panelGrid>
											</h:panelGroup>
    									</p:overlayPanel>
    								</h:panelGroup>
    						</p:dataList>
    					</p:column>
    					<p:columns var="typeTrt" 
    					value="#{typeTraitController.typeTraitements}"  
    					style="text-align:center;">
    						<f:facet name="header">
    							<opi:radioButton name="myRadioCol#{variable}"
    								onClick="javascript:{simulateLinkClick('seeTypeTrtForm:submitSelectTypeTrt');}"
    								overrideName="true"
    								value="#{typeTraitController.codeTypeTrtselected}"
    								itemValue="#{typeTrt.code}" itemLabel="#{typeTrt.code}" />
    						</f:facet>
    						<p:dataList var="indVoeuxPojo" value="#{individuPojo.indVoeuxPojo}"
    							rowIndexVar="countIndVoeux">
    							<h:panelGroup style="margin:0px;padding:0px;" 
    							rendered="#{!indVoeuxPojo.indVoeu.haveBeTraited 
    										|| !paginatorIndividuPojo.indRechPojo.excludeWishProcessed}">
    								<opi:radioButton name="trtCmiTypTrt:#{variable}:#{countIndVoeux}" overrideName="true"
    									value="#{indVoeuxPojo.indVoeu.codTypeTrait}"
    									itemValue="#{typeTrt.code}" />
    							</h:panelGroup>
    						</p:dataList>
    					</p:columns>
    				</p:dataTable>
    			</div>
    		</h:form>
    
    		<h:outputText value="#{msgs['INDIVIDU.NOT.FOUND']}"
    			rendered="#{empty paginatorIndividuPojo.visibleItems}" />
    
    		<br />
    		<br />
    		<br />
    
    	</div>
    	
    	<script type="text/javascript">
        	highlightChildrenLiTags('navigationHeader:navigation');
        	highlightChildrenLiTags('navigationFooter:navigation');
        	hideElement('seeTypeTrtForm:individuData:submitPageSize');
        	hideElement('seeTypeTrtForm:submitSelectTypeTrt');
        </script>
    </ui:define>
</ui:composition>
