<ui:composition xmlns:f="http://java.sun.com/jsf/core"
    xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns:h="http://java.sun.com/jsf/html"
    xmlns:p="http://primefaces.org/ui"
    template="template.xhtml">
    <ui:define name="content">
    	<div id="maPage" class="div_body">
    		<script type="text/javascript">
    			var userSelected = false;
    			function selectUser(linkId) {
    				if (!userSelected) {
    			  		userSelected = true;
    					simulateLinkClick(linkId);
    			  	}
    			}
    		</script>
    
    		<h1><h:outputText value="#{managedAccess.currentTraitement.libelle}" /></h1>
    		
    		<div class="messageForUser">
    			<p:message id="messages" showDetail="true" autoUpdate="true" />
    		</div>
    		
    		<ui:include src="_block/_sendMailStudent.xhtml" />    		
    		<ui:include src="_block/_enterPM.xhtml" />
    		
    		<ui:fragment rendered="#{!(pjController.currentCmiPojo != null 
    			&& pjController.currentCmiPojo.state.displayPJ)}"> 
    			<ui:include src="/stylesheets/gestionnaire/opinion/_block/_lookForIndividuPM.jsp" />
    		</ui:fragment>    				
    		<br />
    		<br />
    		<h:form id="seeIndividusForm">    
    			<div style="width:100%;">
    				<h:panelGrid columns="2" columnClasses="col1UnDemi,col2UnDemi"
    					styleClass="tableJustWidthMax">
    					<h:outputText value="#{msgs['PM.TITLE.SEE']}"
    						styleClass="section-smallTitle" />
    					<h:panelGroup>
    						<p:commandButton value="#{msgs['_.BUTTON.UPDATE']}"
    								action="#{pjController.changeStateAll}"
    								rendered="#{(managedAccess.updateAuthorized
    									|| managedAccess.addAuthorized) && !(pjController.currentCmiPojo != null 
    									&& pjController.currentCmiPojo.state.displayPJ)}">
    						</p:commandButton>
    						<p:commandButton id="changeAllState" value="#{msgs['_.BUTTON.CHANGE']}"
    							action="#{pjController.putStateAll}" />
    						<p:commandButton value="#{msgs['_.BUTTON.BACK']}" immediate="true"
    							action="#{managedAccess.goDisplayFunction}" 
    							rendered="#{!(pjController.currentCmiPojo != null 
    						&& pjController.currentCmiPojo.state.displayPJ)}"/>
    					</h:panelGroup>
    				</h:panelGrid>
    			</div>
    			<div style="width:100%;">
    				<p:dataTable var="missingPiecePojos" id="individuData"
    					value="#{paginatorPM.missingPiecePojos}"
    					styleClass="paginatorData"
    					rendered="#{not empty paginatorPM.missingPiecePojos}" rowIndexVar="variable">
    					<f:facet name="header">
    						<h:panelGroup>
    							<e:paginator id="paginatorIndividu"
    								paginator="#{paginatorPM}"
    								itemsName="#{msgs['INDIVIDUS']}"
    								onchange="javascript:{simulateLinkClick('seeIndividusForm:individuData:submitPageSize');}" />
    							<p:commandButton id="submitPageSize"
    								action="#{paginatorPM.forceReload}" />
    						</h:panelGroup>
    					</f:facet>
    					<p:column onclick="selectUser('seeIndividusForm:individuData:#{variable}:updateState')">
    						<f:facet name="header">
    							<h:outputText value="#{msgs['INDIVIDU.NUM_DOSSIER']}" />
    						</f:facet>
    						<h:outputText value="#{missingPiecePojos.individuPojo.individu.numDossierOpi}" />
    					</p:column>
    					<p:column onclick="selectUser('seeIndividusForm:individuData:#{variable}:updateState')">
    						<f:facet name="header">
    							<h:outputText value="#{msgs['FIELD_LABEL.NAME']}" />
    						</f:facet>
    						<h:outputText value="#{missingPiecePojos.individuPojo.individu.nomPatronymique} #{missingPiecePojos.individuPojo.individu.prenom}" />
    					</p:column>
    					<p:column onclick="selectUser('seeIndividusForm:individuData:#{variable}:updateState')">
    						<f:facet name="header">
    							<h:outputText value="#{msgs['INDIVIDU.DATE_NAI_COURT']}" />
    						</f:facet>
    						<h:outputText value="#{missingPiecePojos.individuPojo.individu.dateNaissance}">
    							<f:convertDateTime pattern="dd/MM/yyyy"
    								timeZone="#{sessionController.timezone}" />
    						</h:outputText>
    					</p:column>
    					<p:column>
    						<f:facet name="header">
    							<h:outputText value="#{msgs['FIELD_LABEL.MAIL_PERSO']}" />
    						</f:facet>
    						<h:outputLink
    							value="mailto:#{missingPiecePojos.individuPojo.individu.adressMail}">
    							<h:outputText
    								value="#{missingPiecePojos.individuPojo.individu.adressMail}" />
    						</h:outputLink>
    					</p:column>
    					<p:column>
    						<p:commandButton image="/media/images/update.png"
    							styleClass="form-button-image" id="updateState" immediate="true"
    							title="#{msgs['_.BUTTON.UPDATE']}"
    							rendered="#{managedAccess.updateAuthorized && !(pjController.currentCmiPojo != null 
    									&& pjController.currentCmiPojo.state.displayPJ)}"
    							action="#{pjController.goSeePMEtudiant}">
    							<f:setPropertyActionListener value="#{missingPiecePojos}" target="#{pjController.mpPojoSelected}" />
    						</p:commandButton>
    					</p:column>
    					<p:column>
    						<f:facet name="header">
    							<h:outputText value="#{msgs['COMMISSIONS']}" />
    						</f:facet>
    						<p:dataList
    							 var="commissionPojo" id="titrecom"
     							 value="#{missingPiecePojos.cmiKeySet}" >
                                    <h:outputText value="#{commissionPojo.commission.code}" id="codeCom" />
                                    <p:overlayPanel for="codeCom"
                                        showEvent="mouseover"
                                        hideEvent="mouseout"
                                        styleClass="containerPopup">
    									<h:panelGroup>
    										<h:panelGrid columns="1">
    											<h:outputText styleClass="titrePopupAide"
    												value="#{msgs['FIELD_LABEL.LIBELLE']} #{msgs['FIELD_LABEL.COMMISSION']}" />
    											<h:outputText styleClass="libellesAide"
    												value="#{commissionPojo.commission.libelle}" />
    										</h:panelGrid>
    									</h:panelGroup>
    								</p:overlayPanel>
    						</p:dataList>
    					</p:column>
    					<p:column>
    						<f:facet name="header">
    							<h:panelGroup>
    								<h:outputText value="#{msgs['STATE.NON_ARRIVE']}" />
    								<opi:radioButton id="radioHeaderId1" name="myRadioHeader"
    									overrideName="true" value="#{pjController.stateSelected}"
    									onClick="simulateLinkClick('seeIndividusForm:changeAllState')"
    									itemValue="STATE.NON_ARRIVE" />
    							</h:panelGroup>
    							
    						</f:facet>
    						<p:dataList
    							 var="commissionPojo" id="titrecom"
     							 value="#{missingPiecePojos.cmiKeySet}" 
     							 rowIndexVar="rowVar">
    							<opi:radioButton id="myRadioId1" name="myRadioCol#{variable}#{rowVar}"
    								overrideName="true" value="#{commissionPojo.stateCurrent}"
    								itemValue="STATE.NON_ARRIVE" />
    						</p:dataList>
    					</p:column>
    					<p:column>
    						<f:facet name="header">
    							<h:panelGroup>
    								<h:outputText value="#{msgs['STATE.ARRIVE_COMPLET']}" />
    								<opi:radioButton id="radioHeaderId2" name="myRadioHeader"
    									overrideName="true" value="#{pjController.stateSelected}"
    									onClick="simulateLinkClick('seeIndividusForm:changeAllState')"
    									itemValue="STATE.ARRIVE_COMPLET" />
    							</h:panelGroup>
    						</f:facet>
    						<p:dataList
    							 var="commissionPojo" id="titrecom"
     							 value="#{missingPiecePojos.cmiKeySet}" 
     							 rowIndexVar="rowVar">
    							<opi:radioButton id="myRadioId2" name="myRadioCol#{variable}#{rowVar}"
    								overrideName="true" value="#{commissionPojo.stateCurrent}"
    								itemValue="STATE.ARRIVE_COMPLET" />
    						</p:dataList>
    					</p:column>
    					<p:column>
    						<f:facet name="header">
    							<h:panelGroup>
    								<h:outputText value="#{msgs['STATE.ARRIVE_INCOMPLET']}" />
    								<opi:radioButton id="radioHeaderId3" name="myRadioHeader"
    									overrideName="true" value="#{pjController.stateSelected}"
    									onClick="simulateLinkClick('seeIndividusForm:changeAllState')"
    									itemValue="STATE.ARRIVE_INCOMPLET" />
    							</h:panelGroup>
    						</f:facet>
    						<p:dataList
    							 var="commissionPojo" id="titrecom"
     							 value="#{missingPiecePojos.cmiKeySet}" 
     							 rowIndexVar="rowVar">
                                <opi:radioButton id="myRadioId3" name="myRadioCol#{variable}#{rowVar}"
                                	overrideName="true" value="#{commissionPojo.stateCurrent}"
                                	itemValue="STATE.ARRIVE_INCOMPLET" />
    						</p:dataList>
    					</p:column>
    					<p:column styleClass="buttonTD">
    						<p:dataList
    							 var="commissionPojo" id="titrecom"
     							 value="#{missingPiecePojos.cmiKeySet}">
    							<p:commandButton value="#{msgs['_.BUTTON.UPDATE']}"
    								action="#{pjController.changeState}"
    								rendered="#{(managedAccess.updateAuthorized
    									|| managedAccess.addAuthorized) && !(pjController.currentCmiPojo != null 
    									&& pjController.currentCmiPojo.state.displayPJ)}">
    								<f:setPropertyActionListener value="#{commissionPojo}" target="#{pjController.currentCmiPojo}" />
    								<f:setPropertyActionListener value="#{missingPiecePojos}" target="#{pjController.mpPojoSelected}" />
    							</p:commandButton>
    						</p:dataList>
    					</p:column>
    					<p:column styleClass="buttonTD">
    						<p:dataList
    							 var="commissionPojo" id="titrecom"
     							 value="#{missingPiecePojos.cmiKeySet}">
     							 <ul style="margin:0px;padding:0px;height:20px;">
    								<p:commandButton image="/media/images/magnifier.png"
    									styleClass="form-button-image" immediate="true"
    									action="#{pjController.seeMissingPiecePrincipal}"
    									title="#{msgs['_.BUTTON.DISPLAY']}"
    									rendered="#{!(pjController.currentCmiPojo != null 
    									&& pjController.currentCmiPojo.state.displayPJ)}">
    									<f:setPropertyActionListener value="#{commissionPojo}" target="#{pjController.currentCmiPojo}" />
    									<f:setPropertyActionListener value="#{missingPiecePojos}" target="#{pjController.mpPojoSelected}" />
    								</p:commandButton>
    							</ul>
    						</p:dataList>
    					</p:column>
    				</p:dataTable>
    			</div>
    		</h:form>
    		<br />
    		<br />
    		<br />
    	</div>    	
    	<script type="text/javascript">
        	highlightChildrenLiTags('navigationHeader:navigation');
        	highlightChildrenLiTags('navigationFooter:navigation');
        	hideElement('seeIndividusForm:individuData:submitPageSize');
        	hideElement('seeIndividusForm:individuData:submitSelectTypeTrt');
        	hideElement('seeIndividusForm:changeAllState');
        	highlightTableRows('seeIndividusForm:individuData');
        </script>
    </ui:define>
</ui:composition>
